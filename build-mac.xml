<?xml version="1.0" encoding="UTF-8"?>
<?eclipse.ant.import?>
<project basedir="MovieManager" default="jar" name="MeD's Movie Manager">
    
     <property name="app-name" value="MeD's MovieManager.app"/>
     <property name="jar-name" value="MovieManager.jar"/>
    <property name="bin" value="build/bin/"/>
    <property name="jar" value="build/jar"/>
    <property name="dist-mac" value="build/mac"/>
  	<property name="classpath" value="		lib/drivers/hsqldb-1.7.3.3.jar 			lib/drivers/mysql-connector-java-3.1.12-bin.jar 
    										lib/skinlf.jar lib/oalnf.jar 			lib/BrowserLauncher2-10rc4.jar 
		    								lib/jxl.jar 							lib/JNative.jar 
    										lib/retroweaver-all-1.2.2.jar  			lib/useful.jar
    										lib/TableLayout.jar 					lib/log4j-1.2.13.jar 
    										lib/jasperreports-1.2.6.jar 			lib/itext-1.4.5.jar 
    										lib/commons-digester-1.7.jar 			lib/commons-collections-3.2.jar
    										lib/commons-beanutils.jar 				lib/poi-2.5.1-final-20040804.jar 
    										lib/commons-httpclient-3.0.1.jar 		lib/commons-logging-1.1.jar 
    										lib/commons-codec-1.3.jar				lib/castor-1.0.5.jar
    										lib/ProportionLayout.jar				lib/sfc.jar
  											lib/spin.jar							lib/retroweaver-all-2.0.jar
  											lib/driveinfo/sfc.jar"/>
   <target name="clean">
        <delete dir="build"/>
    </target>
    <target depends="clean" name="cleanall"/>
  
    <target name="compile">
    	<mkdir dir="${bin}"/>
        <echo message="${ant.project.name}: ${ant.file}"/>
        <javac debug="true" debuglevel="source,lines,vars" destdir="${bin}" source="1.4" target="1.4">
            <src path="source"/>
            <classpath><fileset dir="." includes="${classpath}"/></classpath>
        </javac>
    </target>
  
    <target depends="compile" name="jar">
 		
    	<mkdir dir="${jar}"/>
    	<mkdir dir="${jar}/lib"/>
    	<copy todir="${jar}/lib">
    		<fileset dir="lib/"/>
    	</copy>

    	<mkdir dir="${jar}/LookAndFeels"/>
    	<copy todir="${jar}/LookAndFeels">
    		<fileset dir="LookAndFeels/"/>
    	</copy>
    	
    	<mkdir dir="${jar}/reports"/>
    	<copy todir="${jar}/reports">
    		<fileset dir="reports/"/>
    	</copy>

    	<copy file="MovieManager.tmx" todir="${jar}"/>
    	
    	<mkdir dir="${bin}/codecs"/>
    	<copy todir="${bin}/codecs">
    		<fileset dir="codecs"/>
    	</copy>

    	<mkdir dir="${bin}/images"/>
    	<copy todir="${bin}/images">
    		<fileset dir="images"/>
    	</copy>
    	
    	<mkdir dir="${bin}/queries"/>
    	<copy todir="${bin}/queries">
    		<fileset dir="queries"/>
    	</copy>
    	
    	<jar destfile="${jar}/MovieManager.jar">
    		<fileset dir="${bin}"/>
    		<manifest>
    			<attribute name="Main-Class" value="net.sf.xmm.moviemanager.MovieManager"/>
	    			<attribute name="Class-Path" value="${classpath}"/>
    		</manifest>
    	</jar>
    </target>
    
    <target name="build-mac" depends="jar">
    	<property name="tempdir" value="${dist-mac}/temp.app"/>
	    <mkdir dir="${tempdir}"/>
	    <mkdir dir="${tempdir}/Contents"/>
	    <mkdir dir="${tempdir}/Contents/MacOS"/>
	    <mkdir dir="${tempdir}/Contents/Resources"/>
	    <mkdir dir="${tempdir}/Contents/Resources/Java"/>
   		<copy file="packaging/mac/JavaApplicationStub" todir="${tempdir}/Contents/MacOS"/>
		<copy file="packaging/mac/log4j.properties" todir="${tempdir}/Contents/Resources/Java"/>
		<copy file="MovieManager.tmx" todir="${tempdir}/Contents/Resources/Java"/>
    	<copy todir="${tempdir}/Contents/Resources/Java/reports">
    		<fileset dir="reports">
        		<include name="**/*"/>
   			</fileset>
		</copy>
		<exec executable="chmod">
			<arg line="755 ${tempdir}/Contents/MacOS/JavaApplicationStub"/>
		</exec>
 		<copy file="packaging/mac/Info.plist" todir="${tempdir}/Contents"/>
 		<copy file="packaging/mac/PkgInfo" todir="${tempdir}/Contents"/>
		<copy file="packaging/mac/MovieManager.icns" todir="${tempdir}/Contents/Resources"/>
    	<copy file="${jar}/${jar-name}" todir="${tempdir}/Contents/Resources/Java"/>
		<copy todir="${tempdir}/Contents/Resources/Java/lib">
    		<fileset dir="lib">
        		<include name="**/*.*"/>
   			</fileset>
		</copy>
		<copy todir="${tempdir}/Contents/Resources/Java/LookAndFeels">
    		<fileset dir="LookAndFeels">
        		<include name="**/*"/>
   			</fileset>
		</copy>
		<exec executable="/Developer/Tools/SetFile">
			<arg line=" -a B ${tempdir}"/>
		</exec>
		<delete dir="${dist-mac}/${app-name}"/>
		<move file="${tempdir}" tofile="${dist-mac}/${app-name}"/>
    </target>
    
    <target name="install-mac" depends="build-mac">
		<move file="${dist-mac}/${app-name}" tofile="/Applications/${app-name}"/>
        </target>
    
    <target name="dist-mac" depends="build-mac">
    	<copy file="../Changelog.txt" todir="${dist-mac}"/>
    	<fileset file="*.dmg" />
    	<delete file="${dist-mac}/MovieManager.dmg"/>
		<exec executable="hdiutil" failonerror="true">
			<arg value="create"/>
			<arg value="-srcfolder"/>
			<arg value="${dist-mac}/"/>
			<arg value="-fs"/>
			<arg value="HFS+"/>
			<arg value="-volname"/>
			<arg value="MeD's Movie Manager"/>
			<arg value="${dist-mac}/temp.dmg"/>
			<arg value="-ov"/>
		</exec>
    	<delete file="${dist-mac}/Readme.rtf"/>
    	<exec executable="hdiutil" failonerror="true">
    		<arg line="convert ${dist-mac}/temp.dmg -format UDZO -imagekey zlib-level=-9 -o ${dist-mac}/MovieManager.dmg -ov"/>
    	</exec>
    	<delete file="${dist-mac}/temp.dmg"/>
    </target>
    <target name="run-mac">
	    <exec executable="open">
			<arg line="${dist-mac}/"/>
		</exec>
 	 </target>
    
</project>
